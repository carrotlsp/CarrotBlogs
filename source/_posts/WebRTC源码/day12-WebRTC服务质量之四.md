---

title: day12-WebRTC服务质量之四、FEC
categories:
  - WebRTC源码
tags:
  - WebRTC
date: 2022-09-18 20:41:31
---

## 五、FEC

### 1、什么是FEC？

![image-20220915073843908](day12-WebRTC服务质量之四/image-20220915073843908.png)

![image-20220915073846676](day12-WebRTC服务质量之四/image-20220915073846676.png)

![image-20220915073849247](day12-WebRTC服务质量之四/image-20220915073849247.png)

![image-20220915073851833](day12-WebRTC服务质量之四/image-20220915073851833.png)

### 2、FEC的原理是什么？

![image-20220915073857671](day12-WebRTC服务质量之四/image-20220915073857671.png)

> 其实就是Data1和Data2进行异或操作（系统为0，不同为1），产生一个新的包R。
>
> 当Data1丢失时，可以通过 Data2和R进行异或操作，恢复 Data1的数据。
>
> 这就是两个包的FEC

![image-20220915073920197](day12-WebRTC服务质量之四/image-20220915073920197.png)

>  那么三个包怎么办呢？其实也一样
>
> 1、2、3异或生成冗余包R1；如果3丢了，可以通过1、2、R1恢复3的数据
>
> 但是如果4、5都丢失了，就无法恢复了。
>
> 有没有办法让4、5也能恢复呢？看下图

![image-20220915073938174](day12-WebRTC服务质量之四/image-20220915073938174.png)

> 增加纵向的冗余包C1、C2、C3 这样抗丢包性就更强多了。
>
> 缺点：产生了更多的冗余包、并且实现复杂度也高了很多。

### 3、那么媒体包的分组与生成FEC的包数由谁决定呢？

![image-20220915073959809](day12-WebRTC服务质量之四/image-20220915073959809.png)

![image-20220915074002490](day12-WebRTC服务质量之四/image-20220915074002490.png)

![image-20220915074005890](day12-WebRTC服务质量之四/image-20220915074005890.png)

- kFecRateTable作用：用于确定我们多少个媒体包进行分组，对这一组的数据进行FEC处理。
- PacketMaskRandomTbl作用：它用于确定我们对这一组的媒体包，采用什么样的保护策略，并且产生多少个冗余包数据。

### 4、WebRTC中FEC的创建？

![image-20220915074022746](day12-WebRTC服务质量之四/image-20220915074022746.png)

![image-20220915074025603](day12-WebRTC服务质量之四/image-20220915074025603.png)

![image-20220915074028289](day12-WebRTC服务质量之四/image-20220915074028289.png)

![image-20220915074031186](day12-WebRTC服务质量之四/image-20220915074031186.png)

![image-20220915074034702](day12-WebRTC服务质量之四/image-20220915074034702.png)

### 5、WebRTC如何为媒体包产生冗余数据？

![image-20220915074041348](day12-WebRTC服务质量之四/image-20220915074041348.png)

![image-20220915074044270](day12-WebRTC服务质量之四/image-20220915074044270.png)

![image-20220915074047035](day12-WebRTC服务质量之四/image-20220915074047035.png)

![image-20220915074049838](day12-WebRTC服务质量之四/image-20220915074049838.png)

### 5、认识WebRTC中FEC的保护因子是什么？

- 保护因子的作用：是对一组媒体包产生多少个FEC包

![image-20220915074101106](day12-WebRTC服务质量之四/image-20220915074101106.png)

- WebRTC的丢包率是以256个为分母进行计算的，也就是256个包中丢了多少个包。

![image-20220915074110424](day12-WebRTC服务质量之四/image-20220915074110424.png)

- 上面就是WebRTC通过保护因子产生冗余包的个数
- 那么保护因子是从哪里来的呢？

![image-20220915074125356](day12-WebRTC服务质量之四/image-20220915074125356.png)

![image-20220915074128647](day12-WebRTC服务质量之四/image-20220915074128647.png)

![image-20220915074131204](day12-WebRTC服务质量之四/image-20220915074131204.png)

![image-20220915074134499](day12-WebRTC服务质量之四/image-20220915074134499.png)

![image-20220915074137559](day12-WebRTC服务质量之四/image-20220915074137559.png)

![image-20220915074140162](day12-WebRTC服务质量之四/image-20220915074140162.png)









