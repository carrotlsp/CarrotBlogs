---

title: day07-音频数据采集
categories:
  - WebRTC源码
tags:
  - WebRTC
date: 2022-08-18 20:41:31
---

## 一、音频设备的初始化

### 1、ADM的全称是什么？

- Audio Device Module，音频设备模块
- 掌握以下是 Audio Device Module 的类关系图

![image-20220826074429949](day07-音频数据采集/image-20220826074429949.png)

### 2、创建ADM的时机

- 总结一句话：就是我们在创建 `PeerConnectionFactory` 的时候，就会创建 ADM 对象

![image-20220826074520651](day07-音频数据采集/image-20220826074520651.png)

### 3、创建ADM的核心过程

- 注意点：会看到两次创建 `MMDevice COM 组件` 的过程，第一次是为了检测平台是否支持，是否能用。第二次才是真正的创建

![image-20220826074551719](day07-音频数据采集/image-20220826074551719.png)

### 4、认识Windows下的 `Core Audio`

- Windows下的 `Core Audio`是比较底层的API，WebRTC就需要这种比较底层的API，可以尽量达到低延迟的效果。

  ![image-20220826074613195](day07-音频数据采集/image-20220826074613195.png)

### 5、了解 音频设备的种类【主要两种】

- 一定要分清楚 `音频适配器设备` vs `音频终端设备`

![image-20220826074632646](day07-音频数据采集/image-20220826074632646.png)

![image-20220826074637383](day07-音频数据采集/image-20220826074637383.png)

![image-20220826074641370](day07-音频数据采集/image-20220826074641370.png)

![image-20220826074645366](day07-音频数据采集/image-20220826074645366.png)

### 6、Core Audio API的种类【了解即可】

- 有独享声音和主音量，这两个概念

![image-20220826074705344](day07-音频数据采集/image-20220826074705344.png)

![image-20220826074714160](day07-音频数据采集/image-20220826074714160.png)

![image-20220826074717878](day07-音频数据采集/image-20220826074717878.png)

![image-20220826074721348](day07-音频数据采集/image-20220826074721348.png)

![image-20220826074726857](day07-音频数据采集/image-20220826074726857.png)

![image-20220826074730319](day07-音频数据采集/image-20220826074730319.png)

### 7、初始化ADM的流程图，后续看代码帮助理解的关键图

![image-20220826074739289](day07-音频数据采集/image-20220826074739289.png)

![image-20220826074744624](day07-音频数据采集/image-20220826074744624.png)

![image-20220826074749260](day07-音频数据采集/image-20220826074749260.png)

### 8、初始化扬声器

- 重点理解：speaker 一般指的就是`扬声器`

![image-20220826074756799](day07-音频数据采集/image-20220826074756799.png)

![image-20220826074800186](day07-音频数据采集/image-20220826074800186.png)

### 9、WebRTC设置channel个数

- 数据要给扬声器，首先要把数据缓存在一个`buffer`中，然后扬声器再从`buffer`中读取数据，播放出来

![image-20220826074821704](day07-音频数据采集/image-20220826074821704.png)

### 10、 ADM初始化之InitMicrophone

![image-20220826074837399](day07-音频数据采集/image-20220826074837399.png)

## 二、接下来就是借助上面已经初始化好的设备，进行播放和采集了

### 1、理解AudioState

- 总结：AudioState是连接上层页面以及底层音频设备的中间层

![image-20220826074901348](day07-音频数据采集/image-20220826074901348.png)

![image-20220826074906484](day07-音频数据采集/image-20220826074906484.png)

![image-20220826074910136](day07-音频数据采集/image-20220826074910136.png)

![image-20220826074915523](day07-音频数据采集/image-20220826074915523.png)

### 2、上面是WebRTC多人同时通信的两种架构 Mesh架构 和 SFU架构

![image-20220826074931890](day07-音频数据采集/image-20220826074931890.png)

![image-20220826074935103](day07-音频数据采集/image-20220826074935103.png)

### 3、Engine、PC、Channel、stream 对象之间的关系？

![image-20220826074954007](day07-音频数据采集/image-20220826074954007.png)

![image-20220826074956972](day07-音频数据采集/image-20220826074956972.png)

![image-20220826075000012](day07-音频数据采集/image-20220826075000012.png)

### 4、WebRTC是如何播放声音的？

![image-20220826075007094](day07-音频数据采集/image-20220826075007094.png)

![image-20220826075010541](day07-音频数据采集/image-20220826075010541.png)

![image-20220826075013598](day07-音频数据采集/image-20220826075013598.png)

- 总结：
  - ①创建ADM对象以及初始化是在PeerconnectionFactory的initialize中进行的
  - ②而声音播放的逻辑实在媒体协商之后，调用setRemoteDescription的时候，再其内部执行的



### 5、InitPlay 的基础知识

- IsInitialized 这个名字不错，学会来

![image-20220826075041245](day07-音频数据采集/image-20220826075041245.png)

![image-20220826075050830](day07-音频数据采集/image-20220826075050830.png)

![image-20220826075054423](day07-音频数据采集/image-20220826075054423.png)

![image-20220826075057120](day07-音频数据采集/image-20220826075057120.png)

![image-20220826075101323](day07-音频数据采集/image-20220826075101323.png)

![image-20220826075106206](day07-音频数据采集/image-20220826075106206.png)

### 6、播放声音的基础API

![image-20220826075114697](day07-音频数据采集/image-20220826075114697.png)

![image-20220826075118267](day07-音频数据采集/image-20220826075118267.png)

![image-20220826075121263](day07-音频数据采集/image-20220826075121263.png)

![image-20220826075129237](day07-音频数据采集/image-20220826075129237.png)

### 7、播放声音的流程？

![image-20220826075136708](day07-音频数据采集/image-20220826075136708.png)

![image-20220826075140431](day07-音频数据采集/image-20220826075140431.png)



![image-20220826075144069](day07-音频数据采集/image-20220826075144069.png)

![image-20220826075147767](day07-音频数据采集/image-20220826075147767.png)

![image-20220826075151540](day07-音频数据采集/image-20220826075151540.png)

### 8、再次认识音频DMO组件

![image-20220826075158308](day07-音频数据采集/image-20220826075158308.png)

![image-20220826075201116](day07-音频数据采集/image-20220826075201116.png)

![image-20220826075203610](day07-音频数据采集/image-20220826075203610.png)

![image-20220826075221576](day07-音频数据采集/image-20220826075221576.png)



![image-20220826075236773](day07-音频数据采集/image-20220826075236773.png)

![image-20220826075244600](day07-音频数据采集/image-20220826075244600.png)

![image-20220826075248821](day07-音频数据采集/image-20220826075248821.png)

![image-20220826075252316](day07-音频数据采集/image-20220826075252316.png)

### 9、认识 `InitRecording`

![image-20220826075300312](day07-音频数据采集/image-20220826075300312.png)

![image-20220826075303047](day07-音频数据采集/image-20220826075303047.png)

![image-20220826075306033](day07-音频数据采集/image-20220826075306033.png)

![image-20220826075308904](day07-音频数据采集/image-20220826075308904.png)

### 10、认识 `StartRecording`

![image-20220826075315971](day07-音频数据采集/image-20220826075315971.png)

![image-20220826075321474](day07-音频数据采集/image-20220826075321474.png)

![image-20220826075324285](day07-音频数据采集/image-20220826075324285.png)

![image-20220826075327265](day07-音频数据采集/image-20220826075327265.png)

![image-20220826075333720](day07-音频数据采集/image-20220826075333720.png)

![image-20220826075340420](day07-音频数据采集/image-20220826075340420.png)